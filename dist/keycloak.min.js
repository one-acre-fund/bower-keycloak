(function(a,c){var b=function(f){if(!(this instanceof b)){return new b(f)}var k=this;var n;var g={enable:true,callbackMap:[],interval:5};k.init=function(x){k.authenticated=false;if(a.Cordova){n=o("cordova")}else{n=o()}if(x){if(typeof x.checkLoginIframe!=="undefined"){g.enable=x.checkLoginIframe}if(x.checkLoginIframeInterval){g.interval=x.checkLoginIframeInterval}if(x.onLoad==="login-required"){k.loginRequired=true}}var y=q();var v=q();v.promise.success(function(){k.onReady&&k.onReady(k.authenticated);y.setSuccess(k.authenticated)}).error(function(){y.setError()});var w=l(f);function u(){var B=i(a.location.search);if(B){a.history.replaceState({},null,location.protocol+"//"+location.host+location.pathname+(B.fragment?"#"+B.fragment:""));h(B,v);return}else{if(x){if(x.token||x.refreshToken){m(x.token,x.refreshToken);v.setSuccess()}else{if(x.onLoad){var z={};switch(x.onLoad){case"check-sso":z.prompt="none";case"login-required":var A=k.login(z);if(A){A.success(function(){v.setSuccess()}).error(function(){v.setError()})}break;default:throw"Invalid value for onLoad"}}}}else{v.setSuccess()}}}w.success(u);w.error(function(){y.setError()});return y.promise};k.login=function(u){return n.login(u)};k.createLoginUrl=function(v){var w=e();var x=n.redirectUri(v);if(v&&v.prompt){if(x.indexOf("?")==-1){x+="?prompt="+v.prompt}else{x+="&prompt="+v.prompt}}sessionStorage.oauthState=w;var u=r()+"/tokens/login?client_id="+encodeURIComponent(k.clientId)+"&redirect_uri="+encodeURIComponent(x)+"&state="+encodeURIComponent(w)+"&response_type=code";if(v&&v.prompt){u+="&prompt="+v.prompt}return u};k.logout=function(u){return n.logout(u)};k.createLogoutUrl=function(v){var u=r()+"/tokens/logout?redirect_uri="+encodeURIComponent(n.redirectUri(v));return u};k.createAccountUrl=function(v){var u=r()+"/account?referrer="+encodeURIComponent(k.clientId)+"&referrer_uri="+encodeURIComponent(n.redirectUri(v));return u};k.accountManagement=function(){return n.accountManagement()};k.hasRealmRole=function(v){var u=k.realmAccess;return !!u&&u.roles.indexOf(v)>=0};k.hasResourceRole=function(w,v){if(!k.resourceAccess){return false}var u=k.resourceAccess[v||k.clientId];return !!u&&u.roles.indexOf(w)>=0};k.loadUserProfile=function(){var u=r()+"/account";var v=new XMLHttpRequest();v.open("GET",u,true);v.setRequestHeader("Accept","application/json");v.setRequestHeader("Authorization","bearer "+k.token);var w=q();v.onreadystatechange=function(){if(v.readyState==4){if(v.status==200){k.profile=JSON.parse(v.responseText);w.setSuccess(k.profile)}else{w.setError()}}};v.send();return w.promise};k.isTokenExpired=function(u){if(!k.tokenParsed||!k.refreshToken){throw"Not authenticated"}var v=k.tokenParsed.exp-(new Date().getTime()/1000);if(u){v-=u}return v<0};k.updateToken=function(u){var x=q();if(!k.tokenParsed||!k.refreshToken){x.setError();return x.promise}u=u||5;var v=function(){if(!k.isTokenExpired(u)){x.setSuccess(false)}else{var A="grant_type=refresh_token&refresh_token="+k.refreshToken;var y=r()+"/tokens/refresh";var z=new XMLHttpRequest();z.open("POST",y,true);z.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(k.clientId&&k.clientSecret){z.setRequestHeader("Authorization","Basic "+btoa(k.clientId+":"+k.clientSecret))}else{A+="&client_id="+encodeURIComponent(k.clientId)}z.onreadystatechange=function(){if(z.readyState==4){if(z.status==200){var B=JSON.parse(z.responseText);m(B.access_token,B.refresh_token);k.onAuthRefreshSuccess&&k.onAuthRefreshSuccess();x.setSuccess(true)}else{k.onAuthRefreshError&&k.onAuthRefreshError();x.setError()}}};z.send(A)}};if(g.enable){var w=p();w.success(function(){v()}).error(function(){x.setError()})}else{v()}return x.promise};function r(){return k.authServerUrl+"/realms/"+encodeURIComponent(k.realm)}function h(v,B){var z=v.code;var x=v.error;var u=v.prompt;if(z){var A="code="+z;var w=r()+"/tokens/access/codes";var y=new XMLHttpRequest();y.open("POST",w,true);y.setRequestHeader("Content-type","application/x-www-form-urlencoded");if(k.clientId&&k.clientSecret){y.setRequestHeader("Authorization","Basic "+btoa(k.clientId+":"+k.clientSecret))}else{A+="&client_id="+encodeURIComponent(k.clientId)}y.withCredentials=true;y.onreadystatechange=function(){if(y.readyState==4){if(y.status==200){var C=JSON.parse(y.responseText);m(C.access_token,C.refresh_token);k.onAuthSuccess&&k.onAuthSuccess();B&&B.setSuccess()}else{k.onAuthError&&k.onAuthError();B&&B.setError()}}};y.send(A)}else{if(x){if(u!="none"){k.onAuthError&&k.onAuthError();B&&B.setError()}else{B&&B.setSuccess()}}}}function l(w){var z=q();var v;if(!f){v="keycloak.json"}else{if(typeof f==="string"){v=f}}if(v){var y=new XMLHttpRequest();y.open("GET",v,true);y.setRequestHeader("Accept","application/json");y.onreadystatechange=function(){if(y.readyState==4){if(y.status==200){var A=JSON.parse(y.responseText);k.authServerUrl=A["auth-server-url"];k.realm=A.realm;k.clientId=A.resource;k.clientSecret=(A.credentials||{})["secret"];z.setSuccess()}else{z.setError()}}};y.send()}else{if(!f.url){var u=document.getElementsByTagName("script");for(var x=0;x<u.length;x++){if(u[x].src.match(/.*keycloak\.js/)){f.url=u[x].src.substr(0,u[x].src.indexOf("/js/keycloak.js"));break}}}if(!f.realm){throw"realm missing"}if(!f.clientId){throw"clientId missing"}k.authServerUrl=f.url;k.realm=f.realm;k.clientId=f.clientId;k.clientSecret=(f.credentials||{}).secret;z.setSuccess()}return z.promise}function s(){if(k.token){m(null,null);k.onAuthLogout&&k.onAuthLogout();if(k.loginRequired){k.login()}}}function m(w,v){if(w||v){t()}if(w){k.token=w;k.tokenParsed=JSON.parse(decodeURIComponent(escape(a.atob(w.split(".")[1]))));var x=k.realm+"/"+k.tokenParsed.sub;if(k.tokenParsed.session_state){x=x+"/"+k.tokenParsed.session_state}k.sessionId=x;k.authenticated=true;k.subject=k.tokenParsed.sub;k.realmAccess=k.tokenParsed.realm_access;k.resourceAccess=k.tokenParsed.resource_access;for(var u=0;u<d.length;u++){var y=d[u];if(k.tokenParsed[y]){if(!k.idToken){k.idToken={}}k.idToken[y]=k.tokenParsed[y]}}}else{delete k.token;delete k.tokenParsed;delete k.subject;delete k.realmAccess;delete k.resourceAccess;delete k.idToken;k.authenticated=false}if(v){k.refreshToken=v;k.refreshTokenParsed=JSON.parse(atob(v.split(".")[1]))}else{delete k.refreshToken;delete k.refreshTokenParsed}}function e(){var x=[];var u="0123456789abcdef";for(var v=0;v<36;v++){x[v]=u.substr(Math.floor(Math.random()*16),1)}x[14]="4";x[19]=u.substr((x[19]&3)|8,1);x[8]=x[13]=x[18]=x[23]="-";var w=x.join("");return w}k.callback_id=0;function j(){var u="<id: "+(k.callback_id++)+(Math.random())+">";return u}function i(v){if(v.indexOf("?")!=-1){var u={};var y=v.split("?")[1].split("&");for(var w=0;w<y.length;w++){var x=y[w].split("=");switch(decodeURIComponent(x[0])){case"code":u.code=x[1];break;case"error":u.error=x[1];break;case"state":u.state=decodeURIComponent(x[1]);break;case"redirect_fragment":u.fragment=decodeURIComponent(x[1]);break;case"prompt":u.prompt=x[1];break}}if((u.code||u.error)&&u.state&&u.state==sessionStorage.oauthState){delete sessionStorage.oauthState;return u}}}function q(){var u={setSuccess:function(v){u.success=true;u.result=v;if(u.successCallback){u.successCallback(v)}},setError:function(v){u.error=true;u.result=v;if(u.errorCallback){u.errorCallback(v)}},promise:{success:function(v){if(u.success){v(u.result)}else{if(!u.error){u.successCallback=v}}return u.promise},error:function(v){if(u.error){v(u.result)}else{if(!u.success){u.errorCallback=v}}return u.promise}}};return u}function t(){if(!g.enable||g.iframe){return}var w=document.createElement("iframe");w.onload=function(){var y=r();if(y.charAt(0)==="/"){g.iframeOrigin=a.location.origin}else{g.iframeOrigin=y.substring(0,y.indexOf("/",8))}g.iframe=w};var x=r()+"/login-status-iframe.html?client_id="+encodeURIComponent(k.clientId)+"&origin="+a.location.origin;w.setAttribute("src",x);w.style.display="none";document.body.appendChild(w);var v=function(y){if(y.origin!==g.iframeOrigin){return}var z=y.data;var A=g.callbackMap[z.callbackId];delete g.callbackMap[z.callbackId];if(k.sessionId==z.session&&z.loggedIn){A.setSuccess()}else{s();A.setError()}};a.addEventListener("message",v,false);var u=function(){p();if(k.token){setTimeout(u,g.interval*1000)}};setTimeout(u,g.interval*1000)}function p(){var w=q();if(g.iframe||g.iframeOrigin){var v={};v.callbackId=j();g.callbackMap[v.callbackId]=w;var u=g.iframeOrigin;g.iframe.contentWindow.postMessage(v,u)}else{w.setSuccess()}return w.promise}function o(u){if(!u||u=="default"){return{login:function(v){a.location.href=k.createLoginUrl(v)},logout:function(v){a.location.href=k.createLogoutUrl(v)},accountManagement:function(){a.location.href=k.createAccountUrl()},redirectUri:function(w){if(w&&w.redirectUri){return w.redirectUri}else{if(k.redirectUri){return k.redirectUri}else{var v=(location.protocol+"//"+location.hostname+(location.port&&(":"+location.port))+location.pathname);if(location.hash){v+="?redirect_fragment="+encodeURIComponent(location.hash.substring(1))}return v}}}}}if(u=="cordova"){g.enable=false;return{login:function(w){var A=q();var z="location=no";if(w&&w.prompt=="none"){z+=",hidden=yes"}var y=k.createLoginUrl(w);var x=a.open(y,"_blank",z);var B;var v;x.addEventListener("loadstart",function(C){if(C.url.indexOf("http://localhost")==0){B=i(C.url);x.close()}});x.addEventListener("loaderror",function(C){if(C.url.indexOf("http://localhost")!=0){v=true;x.close()}});x.addEventListener("exit",function(C){if(v||!B){A.setError()}else{h(B,A)}});return A.promise},logout:function(x){var z=q();var v=k.createLogoutUrl(x);var y=a.open(v,"_blank","location=no,hidden=yes");var w;y.addEventListener("loadstart",function(A){if(A.url.indexOf("http://localhost")==0){y.close()}});y.addEventListener("loaderror",function(A){if(A.url.indexOf("http://localhost")!=0){w=true;y.close()}});y.addEventListener("exit",function(A){if(w){z.setError()}else{s();z.setSuccess()}});return z.promise},accountManagement:function(){var v=k.createAccountUrl();var w=a.open(v,"_blank","location=no");w.addEventListener("loadstart",function(x){if(x.url.indexOf("http://localhost")==0){w.close()}})},redirectUri:function(v){return"http://localhost"}}}throw"invalid adapter type: "+u}var d=["name","given_name","family_name","middle_name","nickname","preferred_username","profile","picture","website","email","email_verified","gender","birthdate","zoneinfo","locale","phone_number","phone_number_verified","address","updated_at","formatted","street_address","locality","region","postal_code","country","claims_locales"]};if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=b}else{a.Keycloak=b;if(typeof define==="function"&&define.amd){define("keycloak",[],function(){return b})}}})(window);